# Traefik Helm Chart Values
# These are the values we passed to: helm install traefik traefik/traefik
#
# SWARM EQUIVALENT: This replaces your entire traefik-stack/stack.yaml + traefik-stack/config/traefik.yaml
# In Swarm, Traefik reads the Docker socket to discover services.
# In K8s, Traefik watches the Kubernetes API for Ingress resources instead.
#
# To apply changes: helm upgrade traefik traefik/traefik -n traefik -f values.yaml

# Dashboard - equivalent to your Swarm Traefik dashboard labels
ingressRoute:
  dashboard:
    enabled: true
    matchRule: Host(`traefik.test`)   # Access dashboard at http://traefik.localhost
    # entryPoints: ["web"]
additionalArguments:
  - "--api.insecure=true"
extraObjects:
  - apiVersion: v1
    kind: Service
    metadata:
      name: traefik-api
    spec:
      type: ClusterIP
      selector:
        app.kubernetes.io/name: traefik
        app.kubernetes.io/instance: traefik-default
      ports:
      - port: 8080
        name: traefik
        targetPort: 8080
        protocol: TCP
  - apiVersion: networking.k8s.io/v1
    kind: Ingress
    metadata:
      name: traefik-dashboard
      annotations:
        traefik.ingress.kubernetes.io/router.entrypoints: web
        # traefik.ingress.kubernetes.io/router.middlewares: default-traefik-dashboard-auth@kubernetescrd
    spec:
      rules:
      - host: traefik.test
        http:
          paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: traefik-api
                port:
                  name: traefik

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10

# Ports - equivalent to your Swarm port bindings:
#   ports:
#     - target: 80
#       published: 80
#       mode: host
#     - target: 443
#       published: 443
#       mode: host
ports:
  web:
    port: 8000
    nodePort: 30080       # Accessible on any node at port 30080
  websecure:
    port: 443
    nodePort: 30443       # Accessible on any node at port 30443
